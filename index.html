<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Employee HR System</title>

<style>

body{
font-family:Segoe UI;
background:#eef2f7;
margin:0;
}

/* ‚≠ê STICKY TOP PANEL */
.top{
position:sticky;
top:0;
background:white;
z-index:1000;
padding:20px;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

/* DASHBOARD CARDS */
.dashboard{
display:flex;
gap:20px;
margin-bottom:15px;
}

.card{
flex:1;
padding:15px;
border-radius:8px;
color:white;
font-size:18px;
}

.total{background:#007bff}
.active{background:#28a745}

/* FORM */
input,select{
padding:10px;
margin:5px;
border:1px solid #ccc;
border-radius:5px;
width:170px;
}

button{
padding:10px 15px;
border:none;
background:#007bff;
color:white;
border-radius:5px;
cursor:pointer;
}

button.delete{background:#dc3545}

/* TABLE */
.container{
padding:20px;
}

table{
width:100%;
border-collapse:collapse;
background:white;
}

th,td{
padding:12px;
border-bottom:1px solid #ddd;
}

th{
background:#007bff;
color:white;
position:sticky;
top:180px; /* freeze header */
}

/* STATUS BADGES */
.badge{
padding:5px 10px;
border-radius:20px;
color:white;
font-size:12px;
}

.activeBadge{background:#28a745}
.inactive{background:#6c757d}
.resigned{background:#dc3545}

</style>
</head>

<body>

<!-- ‚≠ê TOP FREEZE AREA -->
<div class="top">

<h2>Employee HR Management</h2>

<div class="dashboard">
<div class="card total">Total Employees: <span id="total">0</span></div>
<div class="card active">Active Staff: <span id="active">0</span></div>
</div>

<input id="search" placeholder="üîç Search..." onkeyup="render()"><br>

<input id="department" placeholder="Department">
<input id="task" placeholder="Task">
<input id="epf" placeholder="EPF">
<input id="name" placeholder="Name">
<input id="contact" placeholder="Contact">
<input id="emergency" placeholder="Emergency">

<select id="status">
<option>Active</option>
<option>Inactive</option>
<option>Resigned</option>
</select>

<input id="remark" placeholder="Resignation Remark">

<button onclick="save()">Save</button>

</div>

<!-- TABLE AREA -->
<div class="container">

<table>
<thead>
<tr>
<th>Dept</th>
<th>Task</th>
<th>EPF</th>
<th>Name</th>
<th>Contact</th>
<th>Emergency</th>
<th>Status</th>
<th>Remark</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<script>

const URL="https://script.google.com/macros/s/AKfycbz0RY4MCx-zBUrl9sbOpiasxYqx3qkgFffAUFRu-vwCiElnwbC_2vb7kIZ_1sjYBB465g/exec";
let data=[], editRow=null;

function load(){
 fetch(URL).then(r=>r.json()).then(d=>{
   data=d;
   render();
 });
}

function getStatus(v){
 if(!v || v==="") return "Active";
 return v;
}

function badge(s){
 if(s==="Active") return `<span class="badge activeBadge">Active</span>`;
 if(s==="Inactive") return `<span class="badge inactive">Inactive</span>`;
 return `<span class="badge resigned">Resigned</span>`;
}

function render(){

 const key=search.value.toLowerCase();
 tbody.innerHTML="";

 let total=0;
 let activeCount=0;

 for(let i=1;i<data.length;i++){

   const r=data[i];
   let status=getStatus(r[6]);

   total++;
   if(status==="Active") activeCount++;

   if(!r.join(" ").toLowerCase().includes(key)) continue;

   tbody.innerHTML+=`
   <tr>
   <td>${r[0]}</td>
   <td>${r[1]}</td>
   <td>${r[2]}</td>
   <td>${r[3]}</td>
   <td>${r[4]}</td>
   <td>${r[5]}</td>
   <td>${badge(status)}</td>
   <td>${r[7]||""}</td>
   <td>
   <button onclick="edit(${i})">Edit</button>
   <button class="delete" onclick="del(${i})">Delete</button>
   </td>
   </tr>`;
 }

 document.getElementById("total").innerText=total;
 document.getElementById("active").innerText=activeCount;
}

function save(){

 let stat=status.value;

 if(remark.value.trim()!=="") stat="Resigned";
 if(!stat) stat="Active";

 fetch(URL,{
 method:"POST",
 body:JSON.stringify({
   action:editRow?"update":"add",
   row:editRow,
   department:department.value,
   task:task.value,
   epf:epf.value,
   name:name.value,
   contact:contact.value,
   emergency:emergency.value,
   status:stat,
   remark:remark.value
 })
 }).then(()=>{clear();load();});
}

function edit(i){
 const r=data[i];
 department.value=r[0];
 task.value=r[1];
 epf.value=r[2];
 name.value=r[3];
 contact.value=r[4];
 emergency.value=r[5];
 status.value=getStatus(r[6]);
 remark.value=r[7]||"";
 editRow=i+1;
}

function del(i){
 if(confirm("Delete employee?")){
 fetch(URL,{
 method:"POST",
 body:JSON.stringify({action:"delete",row:i+1})
 }).then(load);
 }
}

function clear(){
 document.querySelectorAll("input").forEach(i=>i.value="");
 status.value="Active";
 editRow=null;
}

remark.addEventListener("input",()=>{
 if(remark.value.trim()!=="") status.value="Resigned";
});

load();

</script>

</body>
</html>
